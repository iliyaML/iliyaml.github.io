<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/main.5a6da61787dd33a1f4266a84356b6bddb654307deead4955e92a35222a9ea082df264aa3d900cbd28a47bf139cbac4d6504566a6d330e46d959e92faa5df6f86.css integrity="sha512-Wm2mF4fdM6H0JmqENWtr3bZUMH3urUlV6So1IiqeoILfJkqj2QDL0opHvxOcusTWUEVmptMw5G2VnpL6pd9vhg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Week 3 Part 1 - Reinforcement Learning from Human Feedback | iliyaML</title><meta name=description content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><link rel=canonical href=/notes/nlp/generative-ai-with-llms/week-3-part-1/><meta property="og:locale" content><meta property="og:type" content="article"><meta property="og:title" content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><meta property="og:description" content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><meta property="og:url" content="/notes/nlp/generative-ai-with-llms/week-3-part-1/"><meta property="og:site_name" content="iliyaML"><meta property="article:published_time" content="2023-05-23T13:59:39+01:00"><meta property="article:modified_time" content="2023-05-23T13:59:39+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><meta name=twitter:description content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Week 3 Part 1 - Reinforcement Learning from Human Feedback"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"/#/schema/person/1","name":"","url":"/","sameAs":[],"image":{"@type":"ImageObject","@id":"/#/schema/image/1","url":"/\u003cnil\u003e","width":null,"height":null,"caption":""}},{"@type":"WebSite","@id":"/#/schema/website/1","url":"/","name":"iliyaML","description":"Hi, Iâ€™m Iliya ðŸ‘‹","publisher":{"@id":"/#/schema/person/1"}},{"@type":"WebPage","@id":"/notes/nlp/generative-ai-with-llms/week-3-part-1/","url":"/notes/nlp/generative-ai-with-llms/week-3-part-1/","name":"Week 3 Part 1 - Reinforcement Learning from Human Feedback","description":"Week 3 Part 1 - Reinforcement Learning from Human Feedback","isPartOf":{"@id":"/#/schema/website/1"},"about":{"@id":"/#/schema/person/1"},"datePublished":"2023-05-23T13:59:39CET","dateModified":"2023-05-23T13:59:39CET","breadcrumb":{"@id":"/notes/nlp/generative-ai-with-llms/week-3-part-1/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"/notes/nlp/generative-ai-with-llms/week-3-part-1/#/schema/image/2"},"inLanguage":"","potentialAction":[{"@type":"ReadAction","target":["/notes/nlp/generative-ai-with-llms/week-3-part-1/"]}]},{"@type":"BreadcrumbList","@id":"/notes/nlp/generative-ai-with-llms/week-3-part-1/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/","url":"/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"/notesnlpgenerative-ai-with-llmsweek-3-part-1/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"/notes/nlp/generative-ai-with-llms/week-3-part-1/#/schema/image/2","url":null,"contentUrl":null,"caption":"Week 3 Part 1 - Reinforcement Learning from Human Feedback"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=/site.webmanifest></head><body class="notes single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/ aria-label=iliyaML>iliyaML</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasExample aria-controls=offcanvasExample><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasExample aria-labelledby=offcanvasExampleLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasExampleLabel>Browse notes</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-091fa9121c047db1dd48c3e2ab5f3c91 aria-expanded=false>
Machine Learning</button><div class=collapse id=section-091fa9121c047db1dd48c3e2ab5f3c91><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/machine-learning/k-nearest-neighbors/>K-Nearest Neighbors (KNN)</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/linear-regression/>Linear Regression</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/logistic-regression/>Logistic Regression</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a68b6412b3d8a605c374d3c59e02694 aria-expanded=false>
Deep Learning</button><div class=collapse id=section-6a68b6412b3d8a605c374d3c59e02694><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/deep-learning/neural-networks/>Neural Networks</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-85587c49afa2ea2adacd4bbcdb57d064 aria-expanded=true>
NLP</button><div class="collapse show" id=section-85587c49afa2ea2adacd4bbcdb57d064><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/papers/>Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/attention-is-all-you-need/>Attention is All You Need (2017)</a></li><li><a class="docs-link rounded" href=/notes/nlp/state-of-gpt-2023/>State of GPT (2023)</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d275029ac7b5f661dae7a2b707f60c0e aria-expanded=true>
Generative AI with Large Langauge Models</button><div class="collapse show" id=section-d275029ac7b5f661dae7a2b707f60c0e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-1/>Week 1 Part 1 - Introduction to LLMs and the Generative AI Project Lifecycle</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/transformers-architecture/>Week 1 Part 1 - Transformers Architecture</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-2/>Week 1 Part 2 - Pre-training and Scaling Laws</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-research-papers/>Week 1 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-1/>Week 2 Part 1 - Fine-tuning LLMs with Instruction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-2/>Week 2 Part 2 - Parameter Efficient Fine-tuning</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-research-papers/>Week 3 - Research Papers</a></li><li><a class="docs-link rounded active" href=/notes/nlp/generative-ai-with-llms/week-3-part-1/>Week 3 Part 1 - Reinforcement Learning from Human Feedback</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-part-2/>Week 3 Part 2 - LLM-powered Applications</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-research-papers/>Week 2 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/course-conclusion/>Course Conclusion</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c33e404a441c6ba9648f88af3c68a1ca aria-expanded=false>
Statistics</button><div class=collapse id=section-c33e404a441c6ba9648f88af3c68a1ca><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/statistics/introduction/>Introduction</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-89320dbd4e0a792bc1676fde2d5bccfc aria-expanded=false>
DSA</button><div class=collapse id=section-89320dbd4e0a792bc1676fde2d5bccfc><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/dsa/data-structures-and-algorithms/>Data Structures & Algorithms</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-98bf5c1a28c1981bf8d74d4bc73ceaab aria-expanded=false>
System Design</button><div class=collapse id=section-98bf5c1a28c1981bf8d74d4bc73ceaab><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0460583622f03a52d7693094d6fa2452 aria-expanded=false>
Concepts</button><div class=collapse id=section-0460583622f03a52d7693094d6fa2452><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/concepts/basics/>Basics</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/20-concepts/>20 Concepts</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/25-golden-rules/>25 Golden Rules</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/key-steps/>Key Steps</a></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1afa74da05ca145d3418aad9af510109 aria-expanded=false>
Design</button><div class=collapse id=section-1afa74da05ca145d3418aad9af510109><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/design/url-shortener/>URL Shortener</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/short-media-sharing-platform/>Short Media Sharing Platform</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/video-streaming-platform/>Video Streaming Platform</a></li></ul></div></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>iliyaML</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1" href=/about/>About</a></li><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/notes/machine-learning/k-nearest-neighbors>Notes</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder=Search... aria-label=Search... autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/iliyaML><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://www.linkedin.com/in/iliya-mohamad-lokman><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg><small class="ms-2 d-lg-none">LinkedIn</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-091fa9121c047db1dd48c3e2ab5f3c91 aria-expanded=false>
Machine Learning</button><div class=collapse id=section-091fa9121c047db1dd48c3e2ab5f3c91><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/machine-learning/k-nearest-neighbors/>K-Nearest Neighbors (KNN)</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/linear-regression/>Linear Regression</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/logistic-regression/>Logistic Regression</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a68b6412b3d8a605c374d3c59e02694 aria-expanded=false>
Deep Learning</button><div class=collapse id=section-6a68b6412b3d8a605c374d3c59e02694><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/deep-learning/neural-networks/>Neural Networks</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-85587c49afa2ea2adacd4bbcdb57d064 aria-expanded=true>
NLP</button><div class="collapse show" id=section-85587c49afa2ea2adacd4bbcdb57d064><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/papers/>Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/attention-is-all-you-need/>Attention is All You Need (2017)</a></li><li><a class="docs-link rounded" href=/notes/nlp/state-of-gpt-2023/>State of GPT (2023)</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d275029ac7b5f661dae7a2b707f60c0e aria-expanded=true>
Generative AI with Large Langauge Models</button><div class="collapse show" id=section-d275029ac7b5f661dae7a2b707f60c0e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-1/>Week 1 Part 1 - Introduction to LLMs and the Generative AI Project Lifecycle</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/transformers-architecture/>Week 1 Part 1 - Transformers Architecture</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-2/>Week 1 Part 2 - Pre-training and Scaling Laws</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-research-papers/>Week 1 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-1/>Week 2 Part 1 - Fine-tuning LLMs with Instruction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-2/>Week 2 Part 2 - Parameter Efficient Fine-tuning</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-research-papers/>Week 3 - Research Papers</a></li><li><a class="docs-link rounded active" href=/notes/nlp/generative-ai-with-llms/week-3-part-1/>Week 3 Part 1 - Reinforcement Learning from Human Feedback</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-part-2/>Week 3 Part 2 - LLM-powered Applications</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-research-papers/>Week 2 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/course-conclusion/>Course Conclusion</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c33e404a441c6ba9648f88af3c68a1ca aria-expanded=false>
Statistics</button><div class=collapse id=section-c33e404a441c6ba9648f88af3c68a1ca><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/statistics/introduction/>Introduction</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-89320dbd4e0a792bc1676fde2d5bccfc aria-expanded=false>
DSA</button><div class=collapse id=section-89320dbd4e0a792bc1676fde2d5bccfc><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/dsa/data-structures-and-algorithms/>Data Structures & Algorithms</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-98bf5c1a28c1981bf8d74d4bc73ceaab aria-expanded=false>
System Design</button><div class=collapse id=section-98bf5c1a28c1981bf8d74d4bc73ceaab><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0460583622f03a52d7693094d6fa2452 aria-expanded=false>
Concepts</button><div class=collapse id=section-0460583622f03a52d7693094d6fa2452><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/concepts/basics/>Basics</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/20-concepts/>20 Concepts</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/25-golden-rules/>25 Golden Rules</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/key-steps/>Key Steps</a></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1afa74da05ca145d3418aad9af510109 aria-expanded=false>
Design</button><div class=collapse id=section-1afa74da05ca145d3418aad9af510109><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/design/url-shortener/>URL Shortener</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/short-media-sharing-platform/>Short Media Sharing Platform</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/video-streaming-platform/>Video Streaming Platform</a></li></ul></div></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-091fa9121c047db1dd48c3e2ab5f3c91 aria-expanded=false>
Machine Learning</button><div class=collapse id=section-091fa9121c047db1dd48c3e2ab5f3c91><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/machine-learning/k-nearest-neighbors/>K-Nearest Neighbors (KNN)</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/linear-regression/>Linear Regression</a></li><li><a class="docs-link rounded" href=/notes/machine-learning/logistic-regression/>Logistic Regression</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a68b6412b3d8a605c374d3c59e02694 aria-expanded=false>
Deep Learning</button><div class=collapse id=section-6a68b6412b3d8a605c374d3c59e02694><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/deep-learning/neural-networks/>Neural Networks</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-85587c49afa2ea2adacd4bbcdb57d064 aria-expanded=true>
NLP</button><div class="collapse show" id=section-85587c49afa2ea2adacd4bbcdb57d064><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/papers/>Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/attention-is-all-you-need/>Attention is All You Need (2017)</a></li><li><a class="docs-link rounded" href=/notes/nlp/state-of-gpt-2023/>State of GPT (2023)</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d275029ac7b5f661dae7a2b707f60c0e aria-expanded=true>
Generative AI with Large Langauge Models</button><div class="collapse show" id=section-d275029ac7b5f661dae7a2b707f60c0e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-1/>Week 1 Part 1 - Introduction to LLMs and the Generative AI Project Lifecycle</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/transformers-architecture/>Week 1 Part 1 - Transformers Architecture</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-part-2/>Week 1 Part 2 - Pre-training and Scaling Laws</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-1-research-papers/>Week 1 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-1/>Week 2 Part 1 - Fine-tuning LLMs with Instruction</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-part-2/>Week 2 Part 2 - Parameter Efficient Fine-tuning</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-research-papers/>Week 3 - Research Papers</a></li><li><a class="docs-link rounded active" href=/notes/nlp/generative-ai-with-llms/week-3-part-1/>Week 3 Part 1 - Reinforcement Learning from Human Feedback</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-3-part-2/>Week 3 Part 2 - LLM-powered Applications</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/week-2-research-papers/>Week 2 - Research Papers</a></li><li><a class="docs-link rounded" href=/notes/nlp/generative-ai-with-llms/course-conclusion/>Course Conclusion</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c33e404a441c6ba9648f88af3c68a1ca aria-expanded=false>
Statistics</button><div class=collapse id=section-c33e404a441c6ba9648f88af3c68a1ca><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/statistics/introduction/>Introduction</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-89320dbd4e0a792bc1676fde2d5bccfc aria-expanded=false>
DSA</button><div class=collapse id=section-89320dbd4e0a792bc1676fde2d5bccfc><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/dsa/data-structures-and-algorithms/>Data Structures & Algorithms</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-98bf5c1a28c1981bf8d74d4bc73ceaab aria-expanded=false>
System Design</button><div class=collapse id=section-98bf5c1a28c1981bf8d74d4bc73ceaab><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0460583622f03a52d7693094d6fa2452 aria-expanded=false>
Concepts</button><div class=collapse id=section-0460583622f03a52d7693094d6fa2452><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/concepts/basics/>Basics</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/20-concepts/>20 Concepts</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/25-golden-rules/>25 Golden Rules</a></li><li><a class="docs-link rounded" href=/notes/system-design/concepts/key-steps/>Key Steps</a></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1afa74da05ca145d3418aad9af510109 aria-expanded=false>
Design</button><div class=collapse id=section-1afa74da05ca145d3418aad9af510109><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/notes/system-design/design/url-shortener/>URL Shortener</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/short-media-sharing-platform/>Short Media Sharing Platform</a></li><li><a class="docs-link rounded" href=/notes/system-design/design/video-streaming-platform/>Video Streaming Platform</a></li></ul></div></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li><li><a href=#aligning-models-with-human-values>Aligning Models with Human Values</a><ul><li><a href=#stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model</a></li><li><a href=#models-behaving-badly>Models Behaving Badly</a></li><li><a href=#examples-of-llm-models-behaving-badly>Examples of LLM Models Behaving Badly</a></li><li><a href=#benefits-of-additional-fine-tuning>Benefits of Additional Fine-tuning</a></li></ul></li><li><a href=#reinforcement-learning-from-human-feedback>Reinforcement Learning from Human Feedback</a><ul><li><a href=#fine-tuning-with-human-feedback>Fine-tuning with Human Feedback</a></li><li><a href=#rlhf>RLHF</a></li><li><a href=#reinforcement-learning-overview>Reinforcement Learning Overview</a></li><li><a href=#reinforcement-learning-tic-tac-toe>Reinforcement Learning: Tic-Tac-Toe</a></li><li><a href=#reinforcement-learning-fine-tune-llms>Reinforcement Learning: Fine-tune LLMs</a></li></ul></li><li><a href=#rlhf-obtaining-feedback-from-humans>RLHF: Obtaining Feedback from Humans</a><ul><li><a href=#prepare-dataset-for-human-feedback>Prepare Dataset for Human Feedback</a></li><li><a href=#collect-human-feedback>Collect Human Feedback</a></li><li><a href=#sample-instructions-for-human-labelers>Sample Instructions for Human Labelers</a></li><li><a href=#prepare-labeled-data-for-training>Prepare Labeled Data for Training</a></li></ul></li><li><a href=#rlhf-reward-model>RLHF: Reward Model</a><ul><li><a href=#train-reward-model>Train Reward Model</a></li><li><a href=#use-the-reward-model>Use the Reward Model</a></li></ul></li><li><a href=#rlhf-fine-tuning-with-reinforcement-learning>RLHF: Fine-tuning with Reinforcement Learning</a><ul><li><a href=#use-the-reward-model-to-fine-tune-llm-with-rl>Use the Reward Model to Fine-tune LLM with RL</a></li><li><a href=#rl-algorithm-proximal-policy-optimization>RL Algorithm: Proximal Policy Optimization</a></li></ul></li><li><a href=#optional-proximal-policy-optimization>Optional: Proximal Policy Optimization</a><ul><li><a href=#ppo>PPO</a></li><li><a href=#ppo-phase-1-create-completions>PPO Phase 1: Create Completions</a></li><li><a href=#ppo-phase-2-model-update>PPO Phase 2: Model Update</a></li><li><a href=#ppo-phase-2-calculate-policy-loss>PPO Phase 2: Calculate Policy Loss</a></li><li><a href=#ppo-phase-2-calculate-entropy-loss>PPO Phase 2: Calculate Entropy Loss</a></li><li><a href=#ppo-phase-2-objective-function>PPO Phase 2: Objective Function</a></li><li><a href=#other-reinforcement-learning-techniques>Other Reinforcement Learning Techniques</a></li></ul></li><li><a href=#rlhf-reward-hacking>RLHF: Reward Hacking</a><ul><li><a href=#recap-of-rlhf>Recap of RLHF</a></li><li><a href=#reward-hacking>Reward Hacking</a></li><li><a href=#avoid-reward-hacking>Avoid Reward Hacking</a></li><li><a href=#evaluate-the-human-aligned-llm>Evaluate the Human-aligned LLM</a></li></ul></li><li><a href=#reading-kl-divergence>Reading: KL Divergence</a></li><li><a href=#scaling-human-feedback>Scaling Human Feedback</a><ul><li><a href=#constitutional-ai>Constitutional AI</a></li><li><a href=#example-of-constitutional-principles>Example of Constitutional Principles</a></li></ul></li><li><a href=#lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li><li><a href=#aligning-models-with-human-values>Aligning Models with Human Values</a><ul><li><a href=#stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model</a></li><li><a href=#models-behaving-badly>Models Behaving Badly</a></li><li><a href=#examples-of-llm-models-behaving-badly>Examples of LLM Models Behaving Badly</a></li><li><a href=#benefits-of-additional-fine-tuning>Benefits of Additional Fine-tuning</a></li></ul></li><li><a href=#reinforcement-learning-from-human-feedback>Reinforcement Learning from Human Feedback</a><ul><li><a href=#fine-tuning-with-human-feedback>Fine-tuning with Human Feedback</a></li><li><a href=#rlhf>RLHF</a></li><li><a href=#reinforcement-learning-overview>Reinforcement Learning Overview</a></li><li><a href=#reinforcement-learning-tic-tac-toe>Reinforcement Learning: Tic-Tac-Toe</a></li><li><a href=#reinforcement-learning-fine-tune-llms>Reinforcement Learning: Fine-tune LLMs</a></li></ul></li><li><a href=#rlhf-obtaining-feedback-from-humans>RLHF: Obtaining Feedback from Humans</a><ul><li><a href=#prepare-dataset-for-human-feedback>Prepare Dataset for Human Feedback</a></li><li><a href=#collect-human-feedback>Collect Human Feedback</a></li><li><a href=#sample-instructions-for-human-labelers>Sample Instructions for Human Labelers</a></li><li><a href=#prepare-labeled-data-for-training>Prepare Labeled Data for Training</a></li></ul></li><li><a href=#rlhf-reward-model>RLHF: Reward Model</a><ul><li><a href=#train-reward-model>Train Reward Model</a></li><li><a href=#use-the-reward-model>Use the Reward Model</a></li></ul></li><li><a href=#rlhf-fine-tuning-with-reinforcement-learning>RLHF: Fine-tuning with Reinforcement Learning</a><ul><li><a href=#use-the-reward-model-to-fine-tune-llm-with-rl>Use the Reward Model to Fine-tune LLM with RL</a></li><li><a href=#rl-algorithm-proximal-policy-optimization>RL Algorithm: Proximal Policy Optimization</a></li></ul></li><li><a href=#optional-proximal-policy-optimization>Optional: Proximal Policy Optimization</a><ul><li><a href=#ppo>PPO</a></li><li><a href=#ppo-phase-1-create-completions>PPO Phase 1: Create Completions</a></li><li><a href=#ppo-phase-2-model-update>PPO Phase 2: Model Update</a></li><li><a href=#ppo-phase-2-calculate-policy-loss>PPO Phase 2: Calculate Policy Loss</a></li><li><a href=#ppo-phase-2-calculate-entropy-loss>PPO Phase 2: Calculate Entropy Loss</a></li><li><a href=#ppo-phase-2-objective-function>PPO Phase 2: Objective Function</a></li><li><a href=#other-reinforcement-learning-techniques>Other Reinforcement Learning Techniques</a></li></ul></li><li><a href=#rlhf-reward-hacking>RLHF: Reward Hacking</a><ul><li><a href=#recap-of-rlhf>Recap of RLHF</a></li><li><a href=#reward-hacking>Reward Hacking</a></li><li><a href=#avoid-reward-hacking>Avoid Reward Hacking</a></li><li><a href=#evaluate-the-human-aligned-llm>Evaluate the Human-aligned LLM</a></li></ul></li><li><a href=#reading-kl-divergence>Reading: KL Divergence</a></li><li><a href=#scaling-human-feedback>Scaling Human Feedback</a><ul><li><a href=#constitutional-ai>Constitutional AI</a></li><li><a href=#example-of-constitutional-principles>Example of Constitutional Principles</a></li></ul></li><li><a href=#lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Week 3 Part 1 - Reinforcement Learning from Human Feedback</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li><li><a href=#aligning-models-with-human-values>Aligning Models with Human Values</a><ul><li><a href=#stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model</a></li><li><a href=#models-behaving-badly>Models Behaving Badly</a></li><li><a href=#examples-of-llm-models-behaving-badly>Examples of LLM Models Behaving Badly</a></li><li><a href=#benefits-of-additional-fine-tuning>Benefits of Additional Fine-tuning</a></li></ul></li><li><a href=#reinforcement-learning-from-human-feedback>Reinforcement Learning from Human Feedback</a><ul><li><a href=#fine-tuning-with-human-feedback>Fine-tuning with Human Feedback</a></li><li><a href=#rlhf>RLHF</a></li><li><a href=#reinforcement-learning-overview>Reinforcement Learning Overview</a></li><li><a href=#reinforcement-learning-tic-tac-toe>Reinforcement Learning: Tic-Tac-Toe</a></li><li><a href=#reinforcement-learning-fine-tune-llms>Reinforcement Learning: Fine-tune LLMs</a></li></ul></li><li><a href=#rlhf-obtaining-feedback-from-humans>RLHF: Obtaining Feedback from Humans</a><ul><li><a href=#prepare-dataset-for-human-feedback>Prepare Dataset for Human Feedback</a></li><li><a href=#collect-human-feedback>Collect Human Feedback</a></li><li><a href=#sample-instructions-for-human-labelers>Sample Instructions for Human Labelers</a></li><li><a href=#prepare-labeled-data-for-training>Prepare Labeled Data for Training</a></li></ul></li><li><a href=#rlhf-reward-model>RLHF: Reward Model</a><ul><li><a href=#train-reward-model>Train Reward Model</a></li><li><a href=#use-the-reward-model>Use the Reward Model</a></li></ul></li><li><a href=#rlhf-fine-tuning-with-reinforcement-learning>RLHF: Fine-tuning with Reinforcement Learning</a><ul><li><a href=#use-the-reward-model-to-fine-tune-llm-with-rl>Use the Reward Model to Fine-tune LLM with RL</a></li><li><a href=#rl-algorithm-proximal-policy-optimization>RL Algorithm: Proximal Policy Optimization</a></li></ul></li><li><a href=#optional-proximal-policy-optimization>Optional: Proximal Policy Optimization</a><ul><li><a href=#ppo>PPO</a></li><li><a href=#ppo-phase-1-create-completions>PPO Phase 1: Create Completions</a></li><li><a href=#ppo-phase-2-model-update>PPO Phase 2: Model Update</a></li><li><a href=#ppo-phase-2-calculate-policy-loss>PPO Phase 2: Calculate Policy Loss</a></li><li><a href=#ppo-phase-2-calculate-entropy-loss>PPO Phase 2: Calculate Entropy Loss</a></li><li><a href=#ppo-phase-2-objective-function>PPO Phase 2: Objective Function</a></li><li><a href=#other-reinforcement-learning-techniques>Other Reinforcement Learning Techniques</a></li></ul></li><li><a href=#rlhf-reward-hacking>RLHF: Reward Hacking</a><ul><li><a href=#recap-of-rlhf>Recap of RLHF</a></li><li><a href=#reward-hacking>Reward Hacking</a></li><li><a href=#avoid-reward-hacking>Avoid Reward Hacking</a></li><li><a href=#evaluate-the-human-aligned-llm>Evaluate the Human-aligned LLM</a></li></ul></li><li><a href=#reading-kl-divergence>Reading: KL Divergence</a></li><li><a href=#scaling-human-feedback>Scaling Human Feedback</a><ul><li><a href=#constitutional-ai>Constitutional AI</a></li><li><a href=#example-of-constitutional-principles>Example of Constitutional Principles</a></li></ul></li><li><a href=#lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li><li><a href=#aligning-models-with-human-values>Aligning Models with Human Values</a><ul><li><a href=#stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model</a></li><li><a href=#models-behaving-badly>Models Behaving Badly</a></li><li><a href=#examples-of-llm-models-behaving-badly>Examples of LLM Models Behaving Badly</a></li><li><a href=#benefits-of-additional-fine-tuning>Benefits of Additional Fine-tuning</a></li></ul></li><li><a href=#reinforcement-learning-from-human-feedback>Reinforcement Learning from Human Feedback</a><ul><li><a href=#fine-tuning-with-human-feedback>Fine-tuning with Human Feedback</a></li><li><a href=#rlhf>RLHF</a></li><li><a href=#reinforcement-learning-overview>Reinforcement Learning Overview</a></li><li><a href=#reinforcement-learning-tic-tac-toe>Reinforcement Learning: Tic-Tac-Toe</a></li><li><a href=#reinforcement-learning-fine-tune-llms>Reinforcement Learning: Fine-tune LLMs</a></li></ul></li><li><a href=#rlhf-obtaining-feedback-from-humans>RLHF: Obtaining Feedback from Humans</a><ul><li><a href=#prepare-dataset-for-human-feedback>Prepare Dataset for Human Feedback</a></li><li><a href=#collect-human-feedback>Collect Human Feedback</a></li><li><a href=#sample-instructions-for-human-labelers>Sample Instructions for Human Labelers</a></li><li><a href=#prepare-labeled-data-for-training>Prepare Labeled Data for Training</a></li></ul></li><li><a href=#rlhf-reward-model>RLHF: Reward Model</a><ul><li><a href=#train-reward-model>Train Reward Model</a></li><li><a href=#use-the-reward-model>Use the Reward Model</a></li></ul></li><li><a href=#rlhf-fine-tuning-with-reinforcement-learning>RLHF: Fine-tuning with Reinforcement Learning</a><ul><li><a href=#use-the-reward-model-to-fine-tune-llm-with-rl>Use the Reward Model to Fine-tune LLM with RL</a></li><li><a href=#rl-algorithm-proximal-policy-optimization>RL Algorithm: Proximal Policy Optimization</a></li></ul></li><li><a href=#optional-proximal-policy-optimization>Optional: Proximal Policy Optimization</a><ul><li><a href=#ppo>PPO</a></li><li><a href=#ppo-phase-1-create-completions>PPO Phase 1: Create Completions</a></li><li><a href=#ppo-phase-2-model-update>PPO Phase 2: Model Update</a></li><li><a href=#ppo-phase-2-calculate-policy-loss>PPO Phase 2: Calculate Policy Loss</a></li><li><a href=#ppo-phase-2-calculate-entropy-loss>PPO Phase 2: Calculate Entropy Loss</a></li><li><a href=#ppo-phase-2-objective-function>PPO Phase 2: Objective Function</a></li><li><a href=#other-reinforcement-learning-techniques>Other Reinforcement Learning Techniques</a></li></ul></li><li><a href=#rlhf-reward-hacking>RLHF: Reward Hacking</a><ul><li><a href=#recap-of-rlhf>Recap of RLHF</a></li><li><a href=#reward-hacking>Reward Hacking</a></li><li><a href=#avoid-reward-hacking>Avoid Reward Hacking</a></li><li><a href=#evaluate-the-human-aligned-llm>Evaluate the Human-aligned LLM</a></li></ul></li><li><a href=#reading-kl-divergence>Reading: KL Divergence</a></li><li><a href=#scaling-human-feedback>Scaling Human Feedback</a><ul><li><a href=#constitutional-ai>Constitutional AI</a></li><li><a href=#example-of-constitutional-principles>Example of Constitutional Principles</a></li></ul></li><li><a href=#lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries</a></li></ul></nav></div></nav><p>These notes were developed using lectures/material/transcripts from the <a href=https://www.deeplearning.ai/courses/generative-ai-with-llms/>DeepLearning.AI & AWS - Generative AI with Large Language Models</a> course</p><h2 id=notes>Notes <a href=#notes class=anchor aria-hidden=true>#</a></h2><ul><li>Aligning Models with Human Values<ul><li>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model<ul><li>Fine-tuning - train your models so that they better understand human like prompts and generate more human-like responses</li></ul></li><li>Models Behaving Badly<ul><li>Toxic language</li><li>Aggressive responses</li><li>Providing dangerous information</li></ul></li><li>These problems exist because large models are trained on vast amounts of text data from the Internet where such language appears frequently</li><li>Helpfulness, Honesty and Harmlessness (HHH) - a set of principles that guide developers in the responsible use of AI</li></ul></li><li>Reinforcement Learning from Human Feedback (RLHF)<ul><li>A model fine-tuned on human feedback produced better responses than a pretrained model, an instruct fine-tuned model and even the reference human baseline</li><li>RLHF fine-tunes the LLM with human feedback data, resulting in a model that is better aligned with human preferences</li><li>Benefits<ul><li>Produces outputs that maximize usefulness and relevance to the input prompt</li><li>Minimize the potential for harm</li><li>Train the model to give caveats that acknowledge their limitations and to avoid toxic language and topics</li></ul></li><li>Potential<ul><li>Personalization of LLMs, where models learn the preferences of each individual user through a continuous feedback process</li></ul></li><li>Reinforcement Learning Overview<ul><li><strong>Agent</strong> learns to make decisions to a specific goal by taking <strong>Actions</strong> in an <strong>Environment</strong>, with the objective of maximizing some notion of a cumulative <strong>Reward</strong></li><li>By iterating through this process, the Agent gradually refines its strategy or <strong>Policy</strong> to make better decisions and increase its chances of success</li><li>The goal of Reinforcement Learning is for the Agent to learn the Optimal Policy for a given Environment that maximizes their Rewards</li></ul></li><li>Reinforcement Learning: Fine-tune LLMs<ul><li>Components<ul><li>The agent&rsquo;s policy that guides the actions is the LLM</li><li>Its objective is to generate text that is perceived as being aligned with the human preferences</li><li>The environment is the context window of the model</li><li>The state that the model considers before taking an action is the current context</li><li>The action here is the act of generating text</li><li>The action space is the token vocabulary</li><li>The sequence of actions and states is called a rollout, instead of the term playout that&rsquo;s used in classic reinforcement learning</li></ul></li><li>Reward Model to classify the outputs of the LLM and evaluate the degree of alignment with human preferences<ul><li>Central component of the Reinforcement Learning process</li><li>Encodes all of the preferences that have been learned from human feedback, and it plays a central role in how the model updates its weights over many iterations</li><li>Once trained, use the reward model to assess the output of the LLM and assign a reward value, which in turn gets used to update the weights off the LLM and train a new human aligned version</li></ul></li></ul></li></ul></li><li>RLHF: Obtaining Feedback from Humans<ul><li>Prepare Dataset for Human Feedback<ul><li>Find it easier to start with an instruct model (Instruct LLM) that has already been fine tuned across many tasks and has some general capabilities</li><li>Use this LLM along with a prompt data set to generate a number of different responses for each prompt</li><li>The prompt dataset is comprised of multiple prompts, each of which gets processed by the LLM to produce a set of completions</li></ul></li><li>Collect Human Feedback<ul><li>Collect feedback from human labelers on the completions generated by the LLM<ol><li>Decide what criterion you want the humans to assess the completions on. This could be any of the issues discussed so far like helpfulness or toxicity</li><li>Then ask the labelers to assess each completion in the data set based on that criterion</li></ol></li><li>The same prompt completion sets are usually assigned to multiple human labelers to establish consensus and minimize the impact of poor labelers in the group</li><li>Important: The clarity of your instructions can make a big difference on the quality of the human feedback you obtain<ul><li>The clarity of your instructions can make a big difference on the quality of the human feedback you obtain</li><li>Labelers are often drawn from samples of the population that represent diverse and global thinking</li></ul></li></ul></li></ul></li><li>RLHF: Reward Model<ul><li>No need to include any more humans in the loop once you have the trained Reward Model</li><li>The reward model is usually also a language model</li></ul></li><li>RLHF: Fine-tuning with Reinforcement Learning<ul><li>Components<ul><li>Prompt Dataset - prompt and completion pairs</li><li>Instruct LLM - a model that has good performance on your task of interests</li><li>Reward Model</li><li>RL Algorithm - Proximal Policy Optimization</li></ul></li><li>Use the Reward Model to Fine-tune LLM with Reinforcement Learning</li></ul></li><li>Optional: Proximal Policy Optimization<ul><li>PPO Phase 1 - Create Completions</li><li>PPO Phase 2 - Model Update</li></ul></li><li>RLHF: Reward Hacking<ul><li>Avoid Reward Hacking</li></ul></li><li>Reading: KL (Kullback-Leibler) Divergence</li><li>Scaling Human Feedback<ul><li>Human effort becomes a limited resource<ul><li>The human effort required to produce the trained reward model in the first place is huge</li></ul></li><li>One idea to overcome these limitations is to scale through model self-supervision</li><li>Constitutional AI (proposed in 2022 by researchers at Anthropic) is one approach of scale supervision<ul><li>A method for training models using a set of rules and principles that govern the modelâ€™s behavior</li><li>Together with a set of sample prompts, these form the constitution</li><li>You then train the model to self critique and revise its responses to comply with those principles</li></ul></li></ul></li><li>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries</li></ul><hr><h2 id=aligning-models-with-human-values>Aligning Models with Human Values <a href=#aligning-models-with-human-values class=anchor aria-hidden=true>#</a></h2><h3 id=stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model>Stage 3 of Generative AI Project Lifecycle - Adapt and Align Model <a href=#stage-3-of-generative-ai-project-lifecycle---adapt-and-align-model class=anchor aria-hidden=true>#</a></h3><p><strong>Fine-tuning</strong></p><ul><li>The goal of fine-tuning with instructions, including PEFT methods, is to further train your models so that they better understand human like prompts and generate more human-like responses.</li><li>This can improve a model&rsquo;s performance substantially over the original pre-trained based version, and lead to more natural sounding language.</li><li>However, natural sounding human language brings a new set of challenges.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled.png alt=Untitled></p><h3 id=models-behaving-badly>Models Behaving Badly <a href=#models-behaving-badly class=anchor aria-hidden=true>#</a></h3><ul><li>Seen plenty of headlines about large language models behaving badly.</li><li>Issues include models<ul><li>using toxic language in their completions,</li><li>replying in combative and aggressive voices, and</li><li>providing detailed information about dangerous topics.</li></ul></li><li>These problems exist because large models are trained on vast amounts of text data from the Internet where such language appears frequently</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%201.png alt=Untitled></p><h3 id=examples-of-llm-models-behaving-badly>Examples of LLM Models Behaving Badly <a href=#examples-of-llm-models-behaving-badly class=anchor aria-hidden=true>#</a></h3><ul><li>These important human values, helpfulness, honesty, and harmlessness are sometimes collectively called HHH, and are a set of principles that guide developers in the responsible use of AI</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%202.png alt=Untitled></p><h3 id=benefits-of-additional-fine-tuning>Benefits of Additional Fine-tuning <a href=#benefits-of-additional-fine-tuning class=anchor aria-hidden=true>#</a></h3><ul><li>Additional fine-tuning with human feedback helps to better align models with human preferences and to increase the helpfulness, honesty, and harmlessness of the completions.</li><li>This further training can also help to decrease the toxicity, often models responses and reduce the generation of incorrect information.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%203.png alt=Untitled></p><p>In this lesson, you&rsquo;ll learn how to align models using feedback from humans</p><hr><h2 id=reinforcement-learning-from-human-feedback>Reinforcement Learning from Human Feedback <a href=#reinforcement-learning-from-human-feedback class=anchor aria-hidden=true>#</a></h2><h3 id=fine-tuning-with-human-feedback>Fine-tuning with Human Feedback <a href=#fine-tuning-with-human-feedback class=anchor aria-hidden=true>#</a></h3><ul><li>A model fine-tuned on human feedback produced better responses than a pretrained model, an instruct fine-tuned model, and even the reference human baseline.</li><li>A popular technique to fine-tune large language models with human feedback is called Reinforcement Learning from Human Feedback (RLHF)</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%204.png alt=Untitled></p><h3 id=rlhf>RLHF <a href=#rlhf class=anchor aria-hidden=true>#</a></h3><ul><li>RLHF uses Reinforcement Learning, or RL for short, to fine-tune the LLM with human feedback data, resulting in a model that is better aligned with human preferences.<ul><li>You can use RLHF to make sure that your model produces outputs that maximize usefulness and relevance to the input prompt.</li><li>RLHF can help minimize the potential for harm.</li><li>You can train your model to give caveats that acknowledge their limitations and to avoid toxic language and topics</li></ul></li><li>One potentially exciting application of RLHF is the personalization of LLMs, where models learn the preferences of each individual user through a continuous feedback process.<ul><li>This could lead to exciting new technologies like individualized learning plans or personalized AI assistants</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%205.png alt=Untitled></p><h3 id=reinforcement-learning-overview>Reinforcement Learning Overview <a href=#reinforcement-learning-overview class=anchor aria-hidden=true>#</a></h3><ul><li>Reinforcement Learning is a type of machine learning in which an agent learns to make decisions related to a specific goal by taking actions in an environment, with the objective of maximizing some notion of a cumulative reward</li><li>In this framework, the agent continually learns from its experiences by taking actions, observing the resulting changes in the environment, and receiving rewards or penalties, based on the outcomes of its actions. By iterating through this process, the agent gradually refines its strategy or policy to make better decisions and increase its chances of success</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%206.png alt=Untitled></p><h3 id=reinforcement-learning-tic-tac-toe>Reinforcement Learning: Tic-Tac-Toe <a href=#reinforcement-learning-tic-tac-toe class=anchor aria-hidden=true>#</a></h3><ul><li>In this example, the agent is a model or policy acting as a Tic-Tac-Toe player.</li><li>Its objective is to win the game.</li><li>The environment is the three by three game board, and the state at any moment, is the current configuration of the board.</li><li>The action space comprises all the possible positions a player can choose based on the current board state.</li><li>The agent makes decisions by following a strategy known as the RL policy.</li><li>Now, as the agent takes actions, it collects rewards based on the actions&rsquo; effectiveness in progressing towards a win.</li><li>The goal of reinforcement learning is for the agent to learn the optimal policy for a given environment that maximizes their rewards.</li><li>This learning process is iterative and involves trial and error.</li><li>Initially, the agent takes a random action which leads to a new state.</li><li>From this state, the agent proceeds to explore subsequent states through further actions.</li><li>The series of actions and corresponding states form a playout, often called a rollout.</li><li>As the agent accumulates experience, it gradually uncovers actions that yield the highest long-term rewards, ultimately leading to success in the game</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%207.png alt=Untitled></p><h3 id=reinforcement-learning-fine-tune-llms>Reinforcement Learning: Fine-tune LLMs <a href=#reinforcement-learning-fine-tune-llms class=anchor aria-hidden=true>#</a></h3><ul><li><p>In this case, the agent&rsquo;s policy that guides the actions is the LLM, and its objective is to generate text that is perceived as being aligned with the human preferences. This could mean that the text is, for example, helpful, accurate, and non-toxic.</p></li><li><p>The environment is the context window of the model, the space in which text can be entered via a prompt.</p></li><li><p>The state that the model considers before taking an action is the current context. That means any text currently contained in the context window.</p></li><li><p>The action here is the act of generating text. This could be a single word, a sentence, or a longer form text, depending on the task specified by the user.</p></li><li><p>The action space is the token vocabulary, meaning all the possible tokens that the model can choose from to generate the completion.</p></li><li><p>How an LLM decides to generate the next token in a sequence, depends on the statistical representation of language that it learned during its training.</p></li><li><p>At any given moment, the action that the model will take, meaning which token it will choose next, depends on the prompt text in the context and the probability distribution over the vocabulary space.</p></li><li><p>The reward is assigned based on how closely the completions align with human preferences.</p></li><li><p>Given the variation in human responses to language, determining the reward is more complicated than in the Tic-Tac-Toe example.</p></li><li><p>One way you can do this is to have a human evaluate all of the completions of the model against some alignment metric, such as determining whether the generated text is toxic or non-toxic.</p></li><li><p>This feedback can be represented as a scalar value, either a zero or a one.</p></li><li><p>The LLM weights are then updated iteratively to maximize the reward obtained from the human classifier, enabling the model to generate non-toxic completions.</p></li><li><p>However, obtaining human feedback can be time consuming and expensive.</p></li><li><p>As a practical and scalable alternative, you can use an additional model, known as the reward model, to classify the outputs of the LLM and evaluate the degree of alignment with human preferences.</p></li><li><p>You&rsquo;ll start with a smaller number of human examples to train the secondary model by your traditional supervised learning methods.</p></li><li><p>Once trained, you&rsquo;ll use the reward model to assess the output of the LLM and assign a reward value, which in turn gets used to update the weights off the LLM and train a new human aligned version.</p></li><li><p>Exactly how the weights get updated as the model completions are assessed, depends on the algorithm used to optimize the policy.</p></li><li><p>Lastly, note that in the context of language modeling, the sequence of actions and states is called a rollout, instead of the term playout that&rsquo;s used in classic reinforcement learning.</p></li><li><p>The reward model is the central component of the reinforcement learning process.</p></li><li><p>It encodes all of the preferences that have been learned from human feedback, and it plays a central role in how the model updates its weights over many iterations</p></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%208.png alt=Untitled></p><p>Question: When using Reinforcement Learning with Human Feedback (RLHF) to align large language models with human preferences, what is the role of human labelers?</p><p>To score prompt completions, so that this score is used to train the reward model component of the RLHF process.</p><p>Correct
In RLHF, human labelers score a dataset of completions by the original model based on alignment criteria like helpfulness, harmlessness, and honesty. This dataset is used to train the reward model that scores the model completions during the RLHF process.</p><hr><h2 id=rlhf-obtaining-feedback-from-humans>RLHF: Obtaining Feedback from Humans <a href=#rlhf-obtaining-feedback-from-humans class=anchor aria-hidden=true>#</a></h2><h3 id=prepare-dataset-for-human-feedback>Prepare Dataset for Human Feedback <a href=#prepare-dataset-for-human-feedback class=anchor aria-hidden=true>#</a></h3><ul><li>The first step in fine-tuning an LLM with RLHF is to select a model to work with and use it to prepare a data set for human feedback</li><li>The model you choose should have some capability to carry out the task you are interested in, whether this is text summarization, question answering or something else.</li><li>In general, you may find it easier to start with an instruct model (Instruct LLM) that has already been fine tuned across many tasks and has some general capabilities.</li><li>You&rsquo;ll then use this LLM along with a prompt data set to generate a number of different responses for each prompt.</li><li>The prompt dataset is comprised of multiple prompts, each of which gets processed by the LLM to produce a set of completions</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%209.png alt=Untitled></p><h3 id=collect-human-feedback>Collect Human Feedback <a href=#collect-human-feedback class=anchor aria-hidden=true>#</a></h3><ul><li>The next step is to collect feedback from human labelers on the completions generated by the LLM. This is the human feedback portion of reinforcement learning with human feedback<ul><li>First, you must decide what criterion you want the humans to assess the completions on. This could be any of the issues discussed so far like helpfulness or toxicity.</li><li>Once you&rsquo;ve decided, you will then ask the labelers to assess each completion in the data set based on that criterion.</li></ul></li><li>Let&rsquo;s take a look at an example.<ul><li>In this case, the prompt is, my house is too hot.</li><li>You pass this prompt to the LLM, which then generates three different completions.</li><li>The task for your labelers is to rank the three completions in order of helpfulness from the most helpful to least helpful.</li><li>So here the labeler will probably decide that completion two is the most helpful.</li><li>It tells the user something that can actually cool their house and ranks as completion first.</li><li>Neither completion one or three are very helpful, but maybe the labeler will decide that three is the worst of the two because the model actively disagrees with the input from the user.</li><li>So the labeler ranks the top completion second and the last completion third.</li><li>This process then gets repeated for many prompt completion sets, building up a data set that can be used to train the reward model that will ultimately carry out this work instead of the humans.</li><li>The same prompt completion sets are usually assigned to multiple human labelers to establish consensus and minimize the impact of poor labelers in the group.</li><li>Like the third labeler here, whose responses disagree with the others and may indicate that they misunderstood the instructions</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2010.png alt=Untitled></p><p>Important:</p><ul><li>The clarity of your instructions can make a big difference on the quality of the human feedback you obtain.</li><li>Labelers are often drawn from samples of the population that represent diverse and global thinking</li></ul><h3 id=sample-instructions-for-human-labelers>Sample Instructions for Human Labelers <a href=#sample-instructions-for-human-labelers class=anchor aria-hidden=true>#</a></h3><ul><li>Here you can see an example set of instructions written for human labelers.</li><li>This would be presented to the labeler to read before beginning the task and made available to refer back to as they work through the dataset.</li><li>The instructions start with the overall task the labeler should carry out. In this case, to choose the best completion for the prompt. The instructions continue with additional details to guide the labeler on how to complete the task. In general, the more detailed you make these instructions, the higher the likelihood that the labelers will understand the task they have to carry out and complete it exactly as you wish.</li><li>For instance, in the second instruction item, the labelers are told that they should make decisions based on their perception of the correctness and informativeness of the response. They are told they can use the Internet to fact check and find other information.</li><li>They are also given clear instructions about what to do if they identify a tie, meaning a pair of completions that they think are equally correct and informative. The labelers are told that it is okay to rank two completions the same, but they should do this sparingly.</li><li>A final instruction worth calling out here is what to do in the case of a nonsensical confusing or irrelevant answer. In this case, labelers should select F rather than rank, so the poor quality answers can be easily removed. Providing a detailed set of instructions like this increases the likelihood that the responses will be high quality and that individual humans will carry out the task in a similar way to each other. This can help ensure that the ensemble of labeled completions will be representative of a consensus point of view.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2011.png alt=Untitled></p><ul><li>Once your human labelers have completed their assessments off the Prompt completion sets, you have all the data you need to train the reward model, which you will use instead of humans to classify model completions during the reinforcement learning fine-tuning process</li></ul><h3 id=prepare-labeled-data-for-training>Prepare Labeled Data for Training <a href=#prepare-labeled-data-for-training class=anchor aria-hidden=true>#</a></h3><ul><li>Before you start to train the reward model, however, you need to convert the ranking data into a pairwise comparison of completions.</li><li>In other words, all possible pairs of completions from the available choices to a prompt should be classified as 0 or 1 score.</li><li>In the example shown here, there are three completions to a prompt, and the ranking assigned by the human labelers was 2, 1, 3, as shown, where 1 is the highest rank corresponding to the most preferred response.</li><li>With the three different completions, there are three possible pairs<ul><li>purple-yellow</li><li>purple-green</li><li>yellow-green</li></ul></li><li>Depending on the number N of alternative completions per prompt, you will have N choose two combinations.</li><li>For each pair, you will assign a reward of 1 for the preferred response and a reward of 0 for the less preferred response.</li><li>Then you&rsquo;ll reorder the prompts so that the preferred option comes first.</li><li>This is an important step because the reward model expects the preferred completion, which is referred to as y_j first.</li><li>Once you have completed this data restructuring, the human responses will be in the correct format for training the reward model.</li><li>Note that while thumbs-up, thumbs-down feedback is often easier to gather than ranking feedback, ranked feedback gives you more prom completion data to train your reward model.</li><li>As you can see, here you get three prompt completion pairs from each human ranking</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2012.png alt=Untitled></p><hr><h2 id=rlhf-reward-model>RLHF: Reward Model <a href=#rlhf-reward-model class=anchor aria-hidden=true>#</a></h2><ul><li>At this stage, you have everything you need to train the reward model.</li><li>While it has taken a fair amount of human effort to get to this point, by the time you&rsquo;re done training the reward model, you won&rsquo;t need to include any more humans in the loop</li></ul><h3 id=train-reward-model>Train Reward Model <a href=#train-reward-model class=anchor aria-hidden=true>#</a></h3><ul><li>The reward model will effectively take place off the human labeler and automatically choose the preferred completion during the RLHF process.</li><li>This reward model is usually also a language model, for example, BERT that is trained using supervised learning methods on the pairwise comparison data that you prepared from the human labelers assessment off the prompts.</li><li>For a given prompt X, the reward model learns to favor the human-preferred completion y_ j, while minimizing the lock sigmoid off the reward difference, r_j minus r_k</li><li>The human-preferred option is always the first one, labeled y_j</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2013.png alt=Untitled></p><h3 id=use-the-reward-model>Use the Reward Model <a href=#use-the-reward-model class=anchor aria-hidden=true>#</a></h3><ul><li>Once the model has been trained on the human rank prompt-completion pairs, you can use the reward model as a binary classifier to provide a set of logits across the positive and negative classes.</li><li>Logits are the unnormalized model outputs before applying any activation function.</li><li>Let&rsquo;s say you want to detoxify your LLM, and the reward model needs to identify if the completion contains hate speech.</li><li>In this case, the two classes would be notate, the positive class that you ultimately want to optimize for and hate the negative class you want to avoid.</li><li>The logit value of the positive class is what you use as the reward value in RLHF.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2014.png alt=Untitled></p><ul><li>Just to remind you, if you apply a Softmax function to the logits, you will get the probabilities.</li><li>The example here shows a good reward for non-toxic completion and the second example shows a bad reward being given for toxic completion</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2015.png alt=Untitled></p><ul><li>At this point, you have a powerful tool in this reward model for aligning your LLM.</li><li>The next step is to explore how the reward model gets used in the reinforcement learning process to train your human-aligned LLM</li></ul><hr><h2 id=rlhf-fine-tuning-with-reinforcement-learning>RLHF: Fine-tuning with Reinforcement Learning <a href=#rlhf-fine-tuning-with-reinforcement-learning class=anchor aria-hidden=true>#</a></h2><ul><li>Let&rsquo;s bring everything together, and look at how you will use the reward model in the reinforcement learning process to update the LLM weights, and produce a human aligned model.</li></ul><h3 id=use-the-reward-model-to-fine-tune-llm-with-rl>Use the Reward Model to Fine-tune LLM with RL <a href=#use-the-reward-model-to-fine-tune-llm-with-rl class=anchor aria-hidden=true>#</a></h3><ul><li>Remember, you want to start with a model that already has good performance on your task of interests.</li><li>You&rsquo;ll work to align an instruction fine-tuned LLM.<ul><li>First, you&rsquo;ll pass a prompt from your prompt dataset.<ul><li>In this case, a dog is, to the instruct LLM, which then generates a completion, in this case a furry animal.</li></ul></li><li>Next, you sent this completion, and the original prompt to the reward model as the prompt completion pair.</li><li>The reward model evaluates the pair based on the human feedback it was trained on, and returns a reward value.<ul><li>A higher value such as 0.24 as shown here represents a more aligned response.</li><li>A less aligned response would receive a lower value, such as -0.53.</li></ul></li><li>You&rsquo;ll then pass this reward value for the prom completion pair to the reinforcement learning algorithm to update the weights of the LLM, and move it towards generating more aligned, higher reward responses</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2016.png alt=Untitled></p><ul><li>Let&rsquo;s call this intermediate version of the model the RL-updated LLM.</li><li>These series of steps together forms a single iteration of the RLHF process.</li><li>These iterations continue for a given number of epochs, similar to other types of fine-tuning.</li><li>Here you can see that the completion generated by the RL-updated LLM receives a higher reward score, indicating that the updates to weights have resulted in a more aligned completion.</li><li>If the process is working well, you&rsquo;ll see the reward improving after each iteration as the model produces text that is increasingly aligned with human preferences.</li><li>You will continue this iterative process until your model is aligned based on some evaluation criteria, for example, reaching a threshold value for the helpfulness you defined.</li><li>You can also define a maximum number of steps, for example, 20,000 as the stopping criteria</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2017.png alt=Untitled></p><ul><li>At this point, let&rsquo;s refer to the fine-tuned model as the Human-aligned LLM</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2018.png alt=Untitled></p><h3 id=rl-algorithm-proximal-policy-optimization>RL Algorithm: Proximal Policy Optimization <a href=#rl-algorithm-proximal-policy-optimization class=anchor aria-hidden=true>#</a></h3><ul><li>One detail we haven&rsquo;t discussed yet is the exact nature of the reinforcement learning algorithm.</li><li>This is the algorithm that takes the output of the reward model and uses it to update the LLM model weights so that the reward score increases over time.</li><li>There are several different algorithms that you can use for this part of the RLHF process.</li><li>A popular choice is Proximal Policy Optimization (PPO)</li><li>PPO is a pretty complicated algorithm, and you don&rsquo;t have to be familiar with all of the details to be able to make use of it.</li><li>However, it can be a tricky algorithm to implement and understanding its inner workings in more detail can help you troubleshoot if you&rsquo;re having problems getting it to work.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2019.png alt=Untitled></p><hr><h2 id=optional-proximal-policy-optimization>Optional: Proximal Policy Optimization <a href=#optional-proximal-policy-optimization class=anchor aria-hidden=true>#</a></h2><h3 id=ppo>PPO <a href=#ppo class=anchor aria-hidden=true>#</a></h3><ul><li>What does PPO stand for and what do those terms mean in the context of reinforcement learning?<ul><li>PPO stands for Proximal Policy Optimization, which is a powerful algorithm for solving reinforcement learning problems.</li><li>As the name suggests, PPO optimizes a policy, in this case the LLM, to be more aligned with human preferences.</li><li>Over many iterations, PPO makes updates to the LLM.</li><li>The updates are small and within a bounded region, resulting in an updated LLM that is close to the previous version, hence the name Proximal Policy Optimization.</li><li>Keeping the changes within this small region result in a more stable learning.</li><li>The goal is to update the policy so that the reward is maximized.</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2020.png alt=Untitled></p><ul><li>How does this work in the specific context of Large Language Models?<ul><li>You start PPO with your initial instruct LLM, then at a high level, each cycle of PPO goes over two phases</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2021.png alt=Untitled></p><h3 id=ppo-phase-1-create-completions>PPO Phase 1: Create Completions <a href=#ppo-phase-1-create-completions class=anchor aria-hidden=true>#</a></h3><ul><li>In Phase I, the LLM, is used to carry out a number of experiments, completing the given prompts.</li><li>These experiments allow you to update the LLM against the reward model in Phase II.</li><li>Remember that the reward model captures the human preferences. For example, the reward can define how helpful, harmless, and honest the responses are.</li><li>The expected reward of a completion is an important quantity used in the PPO objective.</li><li>We estimate this quantity through a separate head of the LLM called the value function</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2022.png alt=Untitled></p><ul><li>Let&rsquo;s have a closer look at the value function and the value loss.</li><li>Assume a number of prompts are given.</li><li>First, you generate the LLM responses to the prompts, then you calculate the reward for the prompt completions using the reward model.</li><li>For example, the first prompt completion shown here might receive a reward of 1.87.</li><li>The next one might receive a reward of -1.24, and so on. You have a set of prompt completions and their corresponding rewards</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2023.png alt=Untitled></p><ul><li>The value function estimates the expected total reward for a given State S.</li><li>In other words, as the LLM generates each token of a completion, you want to estimate the total future reward based on the current sequence of tokens.</li><li>You can think of this as a baseline to evaluate the quality of completions against your alignment criteria.</li><li>Let&rsquo;s say that at this step of completion, the estimated future total reward is 0.34</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2024.png alt=Untitled></p><ul><li><p>With the next generated token, the estimated future total reward increases to 1.23.</p></li><li><p>The goal is to minimize the value loss that is the difference between the actual future total reward in this example, 1.87, and its approximation to the value function, in this example, 1.23.</p></li><li><p>The value loss makes estimates for future rewards more accurate.</p></li><li><p>The value function is then used in Advantage Estimation in Phase 2</p></li><li><p>This is similar to when you start writing a passage, and you have a rough idea of its final form even before you write it</p></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2025.png alt=Untitled></p><h3 id=ppo-phase-2-model-update>PPO Phase 2: Model Update <a href=#ppo-phase-2-model-update class=anchor aria-hidden=true>#</a></h3><ul><li>The losses and rewards determined in Phase 1 are used in Phase 2 to update the weights resulting in an updated LLM.</li><li>In Phase 2, you make a small updates to the model and evaluate the impact of those updates on your alignment goal for the model.</li><li>The model weights updates are guided by the prompt completion, losses, and rewards.</li><li>PPO also ensures to keep the model updates within a certain small region called the trust region.</li><li>This is where the proximal aspect of PPO comes into play. Ideally, this series of small updates will move the model towards higher rewards.</li><li>The PPO policy objective is the main ingredient of this method.</li><li>Remember, the objective is to find a policy whose expected reward is high.</li><li>In other words, you&rsquo;re trying to make updates to the LLM weights that result in completions more aligned with human preferences and so receive a higher reward</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2026.png alt=Untitled></p><h3 id=ppo-phase-2-calculate-policy-loss>PPO Phase 2: Calculate Policy Loss <a href=#ppo-phase-2-calculate-policy-loss class=anchor aria-hidden=true>#</a></h3><ul><li>The policy loss is the main objective that the PPO algorithm tries to optimize during training.</li><li>I know the math looks complicated, but it&rsquo;s actually simpler than it appears.</li><li>Let&rsquo;s break it down step-by-step</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2027.png alt=Untitled></p><ul><li>First, focus on the most important expression and ignore the rest for now.</li><li>Pi of A_t given S_t in this context of an LLM, is the probability of the next token A_t given the current prompt S_t.</li><li>The action A_t is the next token, and the state S_t is the completed prompt up to the token t</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2028.png alt=Untitled></p><ul><li><p>The denominator is the probability of the next token with the initial version of the LLM which is frozen.</p></li><li><p>The numerator is the probabilities of the next token, through the updated LLM, which we can change for the better reward.</p></li><li><p>A-hat_t is called the estimated advantage term of a given choice of action.</p></li><li><p>The advantage term estimates how much better or worse the current action is compared to all possible actions at data state.</p></li><li><p>We look at the expected future rewards of a completion following the new token, and we estimate how advantageous this completion is compared to the rest.</p></li><li><p>There is a recursive formula to estimate this quantity based on the value function that we discussed earlier. Here, we focus on intuitive understanding.</p></li><li><p>Here is a visual representation of what I just described. You have a prompt S, and you have different paths to complete it, illustrated by different paths on the figure.</p></li><li><p>The advantage term tells you how better or worse the current token A_t is with respect to all the possible tokens. In this visualization, the top path which goes higher is better completion, receiving a higher reward.</p></li><li><p>The bottom path goes down which is a worst completion</p></li><li><p>Why does maximizing this term lead to higher rewards?</p><ul><li>Let&rsquo;s consider the case where the advantage is positive for the suggested token.</li><li>A positive advantage means that the suggested token is better than the average.</li><li>Therefore, increasing the probability of the current token seems like a good strategy that leads to higher rewards.</li><li>This translates to maximizing the expression we have here.</li><li>If the suggested token is worse than average, the advantage will be negative.</li><li>Again, maximizing the expression will demote the token, which is the correct strategy.</li><li>So the overall conclusion is that maximizing this expression results in a better aligned LLM</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2029.png alt=Untitled></p><ul><li><p>Let&rsquo;s just maximize this expression then?</p><ul><li>Directly maximizing the expression would lead into problems because our calculations are reliable under the assumption that our advantage estimations are valid.</li><li>The advantage estimates are valid only when the old and new policies are close to each other.</li><li>This is where the rest of the terms come into play</li></ul></li><li><p>So stepping back and looking at the whole equation again, what happens here is that you pick the smaller of the two terms.</p></li><li><p>The one we just discussed and this second modified version of it.</p></li><li><p>Notice that this second expression defines a region, where two policies are near each other.</p></li><li><p>These extra terms are guardrails, and simply define a region in proximity to the LLM, where our estimates have small errors.</p></li><li><p>This is called the trust region. These extra terms ensure that we are unlikely to leave the trust region.</p></li><li><p>In summary, optimizing the PPO policy objective results in a better LLM without overshooting to unreliable regions</p></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2030.png alt=Untitled></p><h3 id=ppo-phase-2-calculate-entropy-loss>PPO Phase 2: Calculate Entropy Loss <a href=#ppo-phase-2-calculate-entropy-loss class=anchor aria-hidden=true>#</a></h3><ul><li>You also have the entropy loss.</li><li>While the policy loss moves the model towards alignment goal, entropy allows the model to maintain creativity.</li><li>If you kept entropy low, you might end up always completing the prompt in the same way as shown here.</li><li>Higher entropy guides the LLM towards more creativity. This is similar to the temperature setting of LLM.</li><li>The difference is that the temperature influences model creativity at the inference time, while the entropy influences the model creativity during training</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2031.png alt=Untitled></p><h3 id=ppo-phase-2-objective-function>PPO Phase 2: Objective Function <a href=#ppo-phase-2-objective-function class=anchor aria-hidden=true>#</a></h3><ul><li>Putting all terms together as a weighted sum, we get our PPO objective, which updates the model towards human preference in a stable manner.</li><li>This is the overall PPO objective.</li><li>The C1 and C2 coefficients are hyperparameters.</li><li>The PPO objective updates the model weights through back propagation over several steps</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2032.png alt=Untitled></p><ul><li>Once the model weights are updated, PPO starts a new cycle</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2033.png alt=Untitled></p><ul><li>For the next iteration, the LLM is replaced with the updated LLM, and a new PPO cycle starts.</li><li>After many iterations, you arrive at the Human-aligned LLM</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2034.png alt=Untitled></p><h3 id=other-reinforcement-learning-techniques>Other Reinforcement Learning Techniques <a href=#other-reinforcement-learning-techniques class=anchor aria-hidden=true>#</a></h3><ul><li>Are there other reinforcement learning techniques that are used for RLHF? Yes.</li><li>For example, Q-learning is an alternate technique for fine-tuning LLMs through RL, but PPO is currently the most popular method.</li><li>In my opinion, PPO is popular because it has the right balance of complexity and performance.</li><li>That being said, fine-tuning the LLMs through human or AI feedback is an active area of research.</li><li>We can expect many more developments in this area in the near future.</li><li>For example, just before we were recording this video, researchers at Stanford published a paper describing a technique called Direct Preference Optimization, which is a simpler alternate to RLHF.</li><li>New methods like this are still in active development, and more work has to be done to better understand their benefits, but I think this is a very exciting area of research</li></ul><hr><h2 id=rlhf-reward-hacking>RLHF: Reward Hacking <a href=#rlhf-reward-hacking class=anchor aria-hidden=true>#</a></h2><h3 id=recap-of-rlhf>Recap of RLHF <a href=#recap-of-rlhf class=anchor aria-hidden=true>#</a></h3><ul><li>RLHF is a fine-tuning process that aligns LLMs with human preferences.</li><li>In this process, you make use of a reward model to assess and LLMs completions of a prompt data set against some human preference metric, like helpful or not helpful.</li><li>Next, you use a reinforcement learning algorithm, in this case, PPO, to update the weights off the LLM based on the reward is signed to the completions generated by the current version off the LLM.</li><li>You&rsquo;ll carry out this cycle of a multiple iterations using many different prompts and updates off the model weights until you obtain your desired degree of alignment.</li><li>Your end result is a Human-aligned LLM that you can use in your application</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2035.png alt=Untitled></p><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2036.png alt=Untitled></p><h3 id=reward-hacking>Reward Hacking <a href=#reward-hacking class=anchor aria-hidden=true>#</a></h3><ul><li>An interesting problem that can emerge in reinforcement learning is known as Reward Hacking, where the agent learns to cheat the system by favoring actions that maximize the reward received even if those actions don&rsquo;t align well with the original objective.</li><li>In the context of LLMs, reward hacking can manifest as the addition of words or phrases to completions that result in high scores for the metric being aligned. But that reduce the overall quality of the language.</li><li>For example, suppose you are using RLHF to detoxify and instruct model.<ul><li>You have already trained a reward model that can carry out sentiment analysis and classify model completions as toxic or non-toxic.</li><li>You select a prompt from the training data this product is, and pass it to the instruct an LLM which generates a completion.</li><li>This one, complete garbage is not very nice and you can expect it to get a high toxic rating.</li><li>The completion is processed by the toxicity of reward model, which generates a score and this is fed to the PPO algorithm, which uses it to update the model weights.</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2037.png alt=Untitled></p><ul><li>As you iterate RLHF will update the LLM to create a less toxic responses.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2038.png alt=Untitled></p><ul><li>However, as the policy tries to optimize the reward, it can diverge too much from the initial language model.</li><li>In this example, the model has started generating completions that it has learned will lead to very low toxicity scores by including phrases like most awesome, most incredible.</li><li>This language sounds very exaggerated.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2039.png alt=Untitled></p><ul><li>The model could also start generating nonsensical, grammatically incorrect text that just happens to maximize the rewards in a similar way, outputs like this are definitely not very useful</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2040.png alt=Untitled></p><h3 id=avoid-reward-hacking>Avoid Reward Hacking <a href=#avoid-reward-hacking class=anchor aria-hidden=true>#</a></h3><ul><li>To prevent our board hacking from happening, you can use the initial instruct LLM as performance reference.</li><li>Let&rsquo;s call it the reference model.</li><li>The weights of the reference model are frozen and are not updated during iterations of RLHF.</li><li>This way, you always maintain a single reference model to compare to.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2041.png alt=Untitled></p><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2042.png alt=Untitled></p><ul><li>During training, each prompt is passed to both models, generating a completion by the reference LLM and the intermediate LLM updated model.</li><li>At this point, you can compare the two completions and calculate a value called the Kullback-Leibler divergence (KL divergence).</li><li>KL divergence is a statistical measure of how different two probability distributions are.</li><li>You can use it to compare the completions off the two models and determine how much the updated model has diverged from the reference.</li><li>The KL divergence algorithm is included in many standard machine learning libraries and you can use it without knowing all the math behind it.</li><li>KL divergence is calculated for each generate a token across the whole vocabulary off the LLM.</li><li>This can easily be tens or hundreds of thousands of tokens.</li><li>However, using a softmax function, you&rsquo;ve reduced the number of probabilities to much less than the full vocabulary size.</li><li>Keep in mind that this is still a relatively compute expensive process.<ul><li>You will almost always benefit from using GPUs.</li></ul></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2043.png alt=Untitled></p><ul><li>Once you&rsquo;ve calculated the KL divergence between the two models, you added acid term to the reward calculation.</li><li>This will penalize the RL updated model if it shifts too far from the reference LLM and generates completions that are two different.</li><li>Note that you now need to full copies of the LLM to calculate the KL divergence, the frozen reference LLM, and the RL-updated PPO LLM.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2044.png alt=Untitled></p><ul><li>By the way, you can benefit from combining our relationship with PEFT.</li><li>In this case, you only update the weights of a PEFT adapter, not the full weights of the LLM.</li><li>This means that you can reuse the same underlying LLM for both the reference model and the PPO model, which you update with a trained PEFT parameters.</li><li>This reduces the memory footprint during training by approximately half.</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2045.png alt=Untitled></p><ul><li>Once you have completed your RLHF alignment of the model, you will want to assess the model&rsquo;s performance.</li></ul><h3 id=evaluate-the-human-aligned-llm>Evaluate the Human-aligned LLM <a href=#evaluate-the-human-aligned-llm class=anchor aria-hidden=true>#</a></h3><ul><li>You can use the summarization data set to quantify the reduction in toxicity, for example, the dialogue, some data set that you saw earlier in the course.</li><li>The number you&rsquo;ll use here is the toxicity score, this is the probability of the negative class, in this case, a toxic or hateful response averaged across the completions.</li><li>If RLHF has successfully reduce the toxicity of your LLM, this score should go down.<ul><li>First, you&rsquo;ll create a baseline toxicity score for the original instruct LLM by evaluating its completions off the summarization data set with a reward model that can assess toxic language.</li><li>Then you&rsquo;ll evaluate your newly human aligned model on the same data set and compare the scores.</li></ul></li><li>In this example, the toxicity score has indeed decreased after RLHF, indicating a less toxic, better aligned model</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2046.png alt=Untitled></p><p>Question: How can RLHF align the performance of large language models with human preferences? Select all that apply</p><hr><p><strong>RLHF can enhance the interpretability of generated text</strong></p><p>Correct</p><p>By involving human feedback, models can be tuned to provide explanations or insights into their decision-making processes, improving interpretability and allowing users to better understand the model&rsquo;s outputs.</p><p><strong>RLHF can help reduce model toxicity and misinformation</strong></p><p>Correct</p><p>The human feedback helps guiding the answers, if the human feedback rewards when toxicity and misinformation is avoided, it will learn reduce that.</p><hr><h2 id=reading-kl-divergence>Reading: KL Divergence <a href=#reading-kl-divergence class=anchor aria-hidden=true>#</a></h2><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2047.png alt=Untitled></p><p>KL-Divergence, or Kullback-Leibler Divergence, is a concept often encountered in the field of reinforcement learning, particularly when using the Proximal Policy Optimization (PPO) algorithm. It is a mathematical measure of the difference between two probability distributions, which helps us understand how one distribution differs from another. In the context of PPO, KL-Divergence plays a crucial role in guiding the optimization process to ensure that the updated policy does not deviate too much from the original policy.</p><p>In PPO, the goal is to find an improved policy for an agent by iteratively updating its parameters based on the rewards received from interacting with the environment. However, updating the policy too aggressively can lead to unstable learning or drastic policy changes. To address this, PPO introduces a constraint that limits the extent of policy updates. This constraint is enforced by using KL-Divergence.</p><p>To understand how KL-Divergence works, imagine we have two probability distributions: the distribution of the original LLM, and a new proposed distribution of an RL-updated LLM. KL-Divergence measures the average amount of information gained when we use the original policy to encode samples from the new proposed policy. By minimizing the KL-Divergence between the two distributions, PPO ensures that the updated policy stays close to the original policy, preventing drastic changes that may negatively impact the learning process.</p><p>A library that you can use to train transformer language models with reinforcement learning, using techniques such as PPO, is TRL (Transformer Reinforcement Learning). In <a href=https://huggingface.co/blog/trl-peft>this link</a> you can read more about this library, and its integration with PEFT (Parameter-Efficient Fine-Tuning) methods, such as LoRA (Low-Rank Adaption). The image shows an overview of the PPO training setup in TRL.</p><hr><h2 id=scaling-human-feedback>Scaling Human Feedback <a href=#scaling-human-feedback class=anchor aria-hidden=true>#</a></h2><ul><li><p>Although you can use a reward model to eliminate the need for human evaluation during RLHF fine-tuning, the human effort required to produce the trained reward model in the first place is huge</p></li><li><p>The labeled data set used to train the reward model typically requires large teams of labelers, sometimes many thousands of people to evaluate many prompts each.</p></li><li><p>This work requires a lot of time and other resources which can be important limiting factors.</p></li><li><p>As the number of models and use cases increases, human effort becomes a limited resource.</p></li><li><p>Methods to scale human feedback are an active area of research.</p></li><li><p>One idea to overcome these limitations is to scale through model self-supervision.</p></li><li><p>Constitutional AI is one approach of scale supervision.</p></li><li><p>First proposed in 2022 by researchers at Anthropic, Constitutional AI is a method for training models using a set of rules and principles that govern the model&rsquo;s behavior.</p></li><li><p>Together with a set of sample prompts, these form the constitution.</p></li><li><p>You then train the model to self critique and revise its responses to comply with those principles</p></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2048.png alt=Untitled></p><ul><li>Constitutional AI is useful not only for scaling feedback, it can also help address some unintended consequences of RLHF</li></ul><h3 id=constitutional-ai>Constitutional AI <a href=#constitutional-ai class=anchor aria-hidden=true>#</a></h3><ul><li>For example, depending on how the prompt is structured, an aligned model may end up revealing harmful information as it tries to provide the most helpful response it can.</li><li>As an example, imagine you ask the model to give you instructions on how to hack your neighbor&rsquo;s WiFi.</li><li>Because this model has been aligned to prioritize helpfulness, it actually tells you about an app that lets you do this, even though this activity is illegal</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2049.png alt=Untitled></p><ul><li>Providing the model with a set of constitutional principles can help the model balance these competing interests and minimize the harm</li></ul><h3 id=example-of-constitutional-principles>Example of Constitutional Principles <a href=#example-of-constitutional-principles class=anchor aria-hidden=true>#</a></h3><ul><li>Here are some example rules from the research paper that Constitutional AI I asks LLMs to follow.</li><li>For example, you can tell the model to choose the response that is the most helpful, honest, and harmless.</li><li>But you can play some bounds on this, asking the model to prioritize harmlessness by assessing whether it&rsquo;s response encourages illegal, unethical, or immoral activity</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2050.png alt=Untitled></p><ul><li><p>Note that you don&rsquo;t have to use the rules from the paper, you can define your own set of rules that is best suited for your domain and use case</p></li><li><p>When implementing the Constitutional AI method, you train your model in two distinct phases.</p></li><li><p>In the first stage, you carry out supervised learning, to start your prompt the model in ways that try to get it to generate harmful responses, this process is called red teaming.</p></li><li><p>You then ask the model to critique its own harmful responses according to the constitutional principles and revise them to comply with those rules.</p></li><li><p>Once done, you&rsquo;ll fine-tune the model using the pairs of red team prompts and the revised constitutional responses</p></li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2051.png alt=Untitled></p><ul><li>As you saw earlier, this model gives you a harmful response as it tries to maximize its helpfulness.</li><li>To mitigate this, you augment the prompt using the harmful completion and a set of predefined instructions that ask the model to critique its response.</li><li>Using the rules outlined in the Constitution, the model detects the problems in its response.</li><li>In this case, it correctly acknowledges that hacking into someone&rsquo;s WiFi is illegal.</li><li>Lastly, you put all the parts together and ask the model to write a new response that removes all of the harmful or illegal content.</li><li>The model generates a new answer that puts the constitutional principles into practice and does not include the reference to the illegal app</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2052.png alt=Untitled></p><ul><li>The original red team prompt, and this final constitutional response can then be used as training data.</li><li>You&rsquo;ll build up a data set of many examples like this to create a fine-tuned LLM that has learned how to generate constitutional responses</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2053.png alt=Untitled></p><ul><li>The second part of the process performs reinforcement learning.</li><li>This stage is similar to RLHF, except that instead of human feedback, we now use feedback generated by a model.</li><li>This is sometimes referred to as reinforcement learning from AI feedback or RLAIF.</li><li>Here you use the fine-tuned model from the previous step to generate a set of responses to your prompt.</li><li>You then ask the model which of the responses is preferred according to the constitutional principles.</li><li>The result is a model generated preference dataset that you can use to train a reward model.</li><li>With this reward model, you can now fine-tune your model further using a reinforcement learning algorithm like PPO, as discussed earlier</li></ul><p><img class="img-fluid lazyload blur-up" src=https://raw.githubusercontent.com/iliyaML/hosting/main/generative-ai-with-llms/week-3-part-1/Untitled%2054.png alt=Untitled></p><ul><li>Aligning models is a very important topic and an active area of research.</li><li>The foundations of RLHF that you&rsquo;ve explored in this lesson will allow you to follow along as the field evolves</li></ul><hr><h2 id=lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries>Lab 3 - Fine-tune FLAN-T5 with Reinforcement Learning to Generate More Positive Summaries <a href=#lab-3---fine-tune-flan-t5-with-reinforcement-learning-to-generate-more-positive-summaries class=anchor aria-hidden=true>#</a></h2><ul><li>You will fine-tune a FLAN-T5 model to generate less toxic content by Facebook&rsquo;s hate speech reward model.</li><li>The reward model is a binary classifier that predicts either &ldquo;not hate&rdquo; or &ldquo;hate&rdquo; for the given text.</li><li>You will use Proximal Policy Optimization (PPO) to fine-tune and detoxify the model</li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=/notes/nlp/generative-ai-with-llms/week-3-research-papers/><div class="card my-1"><div class="card-body py-2">&larr; Week 3 - Research Papers</div></div></a><a class=ms-auto href=/notes/nlp/generative-ai-with-llms/week-3-part-2/><div class="card my-1"><div class="card-body py-2">Week 3 Part 2 - LLM-powered Applications &rarr;</div></div></a></div></main></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-X0X8EQ5BBE"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X0X8EQ5BBE")</script><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Â© 2023 <a class=text-muted href=/>iliyaML</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.650aeec64c81d69d4c0850fc73c93da3f0330cec0a27772feed7f90f60baa5f47f1c45687d71914bdafd1c4e860d40f6dc08ede27a2f08431ff929c9a2d24621.js integrity="sha512-ZQruxkyB1p1MCFD8c8k9o/AzDOwKJ3cv7tf5D2C6pfR/HEVofXGRS9r9HE6GDUD23Ajt4novCEMf+SnJotJGIQ==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.3f0a703c54cbed82ca277187e23cf2d272da28c15ce7e33cde685d40b53d741893d5b74d35bb2d20a81f56c289084f245bdd0c9145d39d7094d3dfbc62d1326a.js integrity="sha512-PwpwPFTL7YLKJ3GH4jzy0nLaKMFc5+M83mhdQLU9dBiT1bdNNbstIKgfVsKJCE8kW90MkUXTnXCU09+8YtEyag==" crossorigin=anonymous defer></script>
<script src=/main.min.cb2e2ebbf2e4002f3117addc33582923b2b3ae5265c22944cd117ebec7abe61c170417c4506d7a0f8f0fc9053dfdf441421d53601ac467042ff3d06ec0ba07fa.js integrity="sha512-yy4uu/LkAC8xF63cM1gpI7KzrlJlwilEzRF+vser5hwXBBfEUG16D48PyQU9/fRBQh1TYBrEZwQv89BuwLoH+g==" crossorigin=anonymous defer></script>
<script src=/index.min.b1ee26cf2e1f00ba1f7a4b4531016b28ae473c2e0d5e74420ce5de9a9ff260e080a6819def966b725a7f266feef499d395910880db87e3b6ec292fb5fc279d32.js integrity="sha512-se4mzy4fALofektFMQFrKK5HPC4NXnRCDOXemp/yYOCApoGd75Zrclp/Jm/u9JnTlZEIgNuH47bsKS+1/CedMg==" crossorigin=anonymous defer></script></body></html>